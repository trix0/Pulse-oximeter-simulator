<!DOCTYPE html>
<html>
<head>
	<title>Oximeter simulator</title>
<!--   <link type="text/css" rel="stylesheet" href="/reset.css">
  <link type="text/css" rel="stylesheet" href="/style.css"> -->
  <link type="text/css" rel="stylesheet" href="reset.css">
  <link type="text/css" rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
</head>
<body>
	<div><h1>Oximeter simulator</h1></div>
	<div class="contentContainer">
		<div class="leftContent">
			<div>
					<div class="onOffContainer">
						<h2>Turn on/off</h2>
						<img src="images/onOff.svg" alt="on/off">
					</div>
					<div class="adjustContainer">
						<h2>Spo2 </h2>
						<div class="control minus">
							<!-- <img src="../images/minus.svg" alt="-"> -->
							<button class="controlButton" data-control="spo2" data-value="-">-</button>
						</div>
						<div class="spo2adjustContainer"></div>
						<div class="control plus">
							<!-- <img src="../images/plus.svg" alt="+"> -->
							<button class="controlButton" data-control="spo2" data-value="+">+</button>
						</div>
					</div>
					<div class="adjustContainer">
						<h2>Pulse </h2>
						<div class="control minus">
							<!-- <img src="../images/minus.svg" alt="-"> -->
							<button class="controlButton" data-control="pulse" data-value="-">-</button>
						</div>
						<div class="spo2adjustContainer"></div>
						<div class="control plus">
							<!-- <img src="../images/plus.svg" alt="+"> -->
							<button class="controlButton" data-control="pulse" data-value="+">+</button>
						</div>
					</div>
			</div>


			<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 166 230.9"><defs><style>.cls-1{fill:#2b2a2a;}.cls-2{fill:url(#linear-gradient);}.cls-3{fill:#3a3a3a;stroke:#9b9b9b;}.cls-3,.cls-4,.cls-7,.cls-8{stroke-miterlimit:10;}.cls-4{fill:#353535;stroke:#636363;}.cls-5{fill:#444343;}.cls-10,.cls-6{font-size:18px;}.cls-6,.cls-7,.cls-8{fill:#fff;}.cls-6{font-family:Impact, Impact;}.cls-7,.cls-8{stroke:#fff;}.cls-8{stroke-linecap:round;stroke-width:2px;}.cls-9{font-size:36px;}.cls-10,.cls-9{fill:#009de0;}.cls-10,.cls-11,.cls-12,.cls-9{font-family:Arial-BoldMT, Arial;font-weight:700;}.cls-11{font-size:11px;}.cls-11,.cls-12{fill:#ddd;}.cls-12{font-size:8px;}</style><linearGradient id="linear-gradient" x1="82.63" y1="79.03" x2="83.29" y2="11.36" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff"/><stop offset="1"/></linearGradient></defs><title>Asset 2</title><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path class="cls-1" d="M163.5,40.57c4,44,2,138,2,138s3,48-52,51c-12.49.68-20.79,1.05-26.18,1.22a33.71,33.71,0,0,1-4.32.1,33.71,33.71,0,0,1-4.32-.1c-5.39-.17-13.69-.54-26.18-1.22-55-3-52-51-52-51s-2-94,2-138S85,.07,85,.07,159.5-3.43,163.5,40.57Z"/><path class="cls-2" d="M2.5,41.07C6.5-2.93,85,.57,85,.57s74.5-3.5,78.5,40.5Z"/><path class="cls-3" d="M157.21,82.08c3.68,32,1.84,100.41,1.84,100.41s2.76,34.92-47.93,37.11c-11.51.49-19.17.76-24.13.88a37.79,37.79,0,0,1-4,.08,37.79,37.79,0,0,1-4-.08c-5-.12-12.62-.39-24.13-.88C4.19,217.41,7,182.49,7,182.49S5.11,114.1,8.79,82.08,84.84,52.61,84.84,52.61,153.52,50.07,157.21,82.08Z"/><path class="cls-4" d="M153.56,84c3.5,30.83,1.75,96.71,1.75,96.71s2.63,33.64-45.58,35.74c-10.94.48-18.22.74-22.94.86-.48.06-1.63.09-3.79.07s-3.31,0-3.79-.07c-4.72-.12-12-.38-22.94-.86-48.21-2.1-45.58-35.74-45.58-35.74S8.94,114.83,12.44,84,84.75,55.61,84.75,55.61,150.05,53.16,153.56,84Z"/><rect class="cls-5" x="27" y="80.57" width="112" height="94"/><text class="cls-6" transform="translate(60.87 200.57)">MONIN</text><path class="cls-7" d="M107.37,151.52c6.1-5,8.44-11.08,6.23-13.85s-6.23.56-6.23.56-4-3.32-6.22-.56S101.28,146.54,107.37,151.52Z"/><path class="cls-8" d="M97.87,140.45s-2.77,2.21,1.11,7.2"/><path class="cls-8" d="M95.08,139.34s-3.62,2.9,1.45,9.41"/><path class="cls-8" d="M117.08,140.45s2.77,2.21-1.1,7.2"/><path class="cls-8" d="M119.88,139.34s3.62,2.9-1.45,9.41"/>
			<text text-anchor="middle" fill="#009de0" font-weight="bold" font-size="2em" class="spo2Value" transform="translate(65 127.07)">--</text>
			<text text-anchor="middle" fill="#009de0" font-weight="bold" class="pulseValue" transform="translate(70.91 150.07)">--</text>
			<text class="cls-11" transform="translate(102.59 116.07)">%</text><text class="cls-12" transform="translate(97.03 124.07)">SpO2</text></g></g></svg>

		</div>
		<div class="rightContent"></div>
	</div>

</body>
<script type="text/javascript" src="./pulseOximeter.js"></script>
<script type="text/javascript">
	const MYURL=""
	const pulseValuePlaceholder=document.querySelector(".pulseValue");
	const spo2ValuePlaceholder=document.querySelector(".spo2Value");
	const onOffButton=document.querySelector(".onOffContainer img");
	const controlButtons = document.querySelectorAll('.controlButton');
	const pulseoxi=new pulseOximeter();
	console.log(pulseoxi);



	controlButtons.forEach(el => el.addEventListener('click', event => {
		let vitalType=event.target.getAttribute("data-control");
		let value=event.target.getAttribute("data-value");
		if(vitalType==="spo2"){

			if(value==="-"){
			  pulseoxi.setVitals(pulseoxi.pulse,pulseoxi.spo2-1);
			}
			else if(value==="+"){
			  pulseoxi.setVitals(pulseoxi.pulse,pulseoxi.spo2+1);
			}
		}
		else if(vitalType==="pulse"){
			if(value==="-"){
			  pulseoxi.setVitals(pulseoxi.pulse-1,pulseoxi.spo2);
			}
			else if(value==="+"){
			  pulseoxi.setVitals(pulseoxi.pulse+1,pulseoxi.spo2);
			}
		}
	}));



	onOffButton.addEventListener("click", ()=>{
		if(pulseoxi.isRunning){

			pulseoxi.turnOff();
		}
		else{
			pulseoxi.turnOn();
		}
	});
	var pulseValue=null;
	var spo2Value=null;

	function setPulseLabel(pulse){
		pulseValue=pulse;
		pulseValuePlaceholder.textContent=pulse;
	}
	function setSpo2Label(spo2){
		spo2Value=spo2;
		spo2ValuePlaceholder.textContent=spo2;
	}




	function sendOximeterData(pulse,spo2){
		console.log(pulse);
		var xhttp=new XMLHttpRequest();
		xhttp.open("POST", MYURL+"/oximeterValues");
		xhttp.setRequestHeader("Content-type", "application/json");
		var data=JSON.stringify({"pulse":pulse,"spo2":spo2});
		xhttp.send(data);
	}
	function sendOximeterRunningData(isRunning){
		console.log(isRunning);
		var xhttp=new XMLHttpRequest();
		xhttp.open("POST", MYURL+"/oximeterState");
		xhttp.setRequestHeader("Content-type", "application/json");
		var data=JSON.stringify({"value":isRunning});
		xhttp.send(data);
	}



	pulseoxi.on("vitalsChanged",(pulse,spo2)=>{
		console.log("Vitals changed:"+pulse+","+spo2);
		setPulseLabel(pulse);
		setSpo2Label(spo2);
		sendOximeterData(pulseValue,spo2Value);
	});
	pulseoxi.on("isRunningChanged",(state)=>{
		console.log("state"+state);
		if(state)
			onOffButton.classList.add("on");
		else
			onOffButton.classList.remove("on");
		sendOximeterRunningData(state);
	});
	pulseoxi.on("error",(error)=>{
		console.log("error"+error);
		//sendOximeterData(pulseValue,spo2Value);
	});

	pulseoxi.turnOff();


</script>
</html>